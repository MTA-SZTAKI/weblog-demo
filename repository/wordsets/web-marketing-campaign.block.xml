<?xml version="1.0" encoding="UTF-8"?>
<block-package xmlns="urn:hu.sztaki.ilab.longneck:1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!-- 
       Extracting web marketing campaign parameters from Goolge utm_*, bannerid and fromagency URL parameters
  -->
  
  <block id="extract.params" version="1.0">
    
    <try-all>
      
      <case>
        <match-extract apply-to="requestUrlParameter" regexp="^.*utm_campaign=([^\,]+).*$">
          <copy apply-to="utm_campaign" from="$1" />
        </match-extract>
      </case>
      
      <case>
        <match-extract apply-to="requestUrlParameter" regexp="^.*utm_source=([^\,]+).*$">
          <copy apply-to="utm_source" from="$1" />
        </match-extract>
      </case>
      
      <case>
        <match-extract apply-to="requestUrlParameter" regexp="^.*utm_medium=([^\,]+).*$">
          <copy apply-to="utm_medium" from="$1" />
        </match-extract>
      </case>
      
      <case>
        <match-extract apply-to="requestUrlParameter" regexp="^.*utm_term=([^\,]+).*$">
          <copy apply-to="utm_term" from="$1" />
        </match-extract>
      </case>
      
      <case>
        <match-extract apply-to="requestUrlParameter" regexp="^.*utm_content=([^\,]+).*$">
          <copy apply-to="utm_content" from="$1" />
        </match-extract>
      </case>
      
      <case>
        <match-extract apply-to="requestUrlParameter" regexp="^.*bannerid=([^\,]+).*$">
          <set apply-to="utm_campaign" value="banner_id"/>
          <copy apply-to="utm_content" from="$1" />
        </match-extract>
      </case>
      
      <case>
        <match-extract apply-to="requestUrlParameter" regexp="^.*fromagency=([^\,]+).*$">
          <set apply-to="utm_campaign" value="fromagency"/>
          <copy apply-to="utm_content" from="$1" />
        </match-extract>
      </case>

    </try-all>

  </block>

</block-package>