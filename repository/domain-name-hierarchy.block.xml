<?xml version="1.0" encoding="UTF-8"?>
<block-package xmlns="urn:hu.sztaki.ilab.longneck:1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">

  <!-- 
    Assembling domain name label-based hierarchy; 
    eg. dms.sztaki.hu: level0: hu, level1: sztaki, level2: dms
  -->
  <block id="main" version="1.0">
    <block-ref id="domain-name-hierarchy:domain-parts" version="1.0"/>
    <block-ref id="domain-name-hierarchy:domain-hierarchy" version="1.0"/>
  </block>

  <block id="domain-hierarchy" version="1.0">
    <set apply-to="hierarchy_type" value="labels" />
  </block>
  
  <block id="cut-domain" version="1.0">
    <match-extract apply-to="url" regexp="^[^\:]*\:\/\/([^\/]*).*$">
      <copy apply-to="domain" from="$1" />
    </match-extract>
  </block>

  <block id="domain-parts" version="1.0">
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level0" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level1" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level2" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level3" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level4" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level5" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level6" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level7" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level8" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level9" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level10" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level11" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level12" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level13" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level14" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
    <match-extract apply-to="domain" regexp="^(.*?)(?:\.)?([^\.]*)$">
      <if>
        <not-null apply-to="$2"/>
        <then>
          <copy apply-to="level15" from="$2" />
        </then>
      </if>
      <if>
        <is-null apply-to="$1"/>
        <then>
          <break />
        </then>
        <else>
          <copy apply-to="domain" from="$1" />
        </else>
      </if>
    </match-extract>
  </block>

</block-package>