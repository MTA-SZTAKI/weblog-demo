<?xml version="1.0" encoding="UTF-8"?>
<process xmlns="urn:hu.sztaki.ilab.longneck:1.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="urn:hu.sztaki.ilab.longneck:1.0 file:/home/lbendig/projects/longneck/longneck-lookup/src/main/resources/META-INF/schema/longneck-lookup.xsd">

  <source>
    <database-source connection-name="weblog_demo">
      <query>
        select  resource_url, freq
        from    webstg.weblog_event_incoming_rsc_tmp
      </query>
    </database-source>
  </source>

  <target>
    <database-target connection-name="weblog_demo">
      <truncate-query>
          delete from weblog_event_incoming_rsc
      </truncate-query>

      <insert-query>
        insert into weblog_event_incoming_rsc (
          JOB_ID, RESOURCE_URL, URL_SCHEME, URL_HOST, URL_PORT, URL_PATH, URL_IS_DIRECTORY,
          HIER_TYPE,
          LEVEL0, LEVEL1, LEVEL2, LEVEL3, LEVEL4, LEVEL5, LEVEL6, LEVEL7, LEVEL8, LEVEL9, LEVEL10, LEVEL11, LEVEL12, LEVEL13, LEVEL14, LEVEL15
        )values (
          '-1', :resource_url, :scheme_type, :url_host,  :url_port, :url_path, :is_directory,
          :hier_type,
          :level0, :level1, :level2, :level3, :level4, :level5, :level6, :level7, :level8, :level9, :level10, :level11, :level12, :level13, :level14, :level15
       )
      </insert-query>

    </database-target>

  </target>

  <error-target>
    <database-target connection-name="weblog_demo">
      <truncate-query>   
        delete from weblog_event_incoming_rsc_err
      </truncate-query>
      <insert-query>
       insert into weblog_event_incoming_rsc_err (
            field, field_value, details, server_host, request_timestamp, document_url, document_line, document_column, class_name
       )values (
            :field, :value, :details, :domain,to_timestamp_tz(:time,'DD/MONTH/YYYY:HH24:MI:SS FFTZH:TZM','NLS_DATE_LANGUAGE= AMERICAN'), 
            :document_url, :document_line, :document_column, :class_name
       )
      </insert-query>
    </database-target>
  </error-target>

  <blocks>  

    <block-ref id="inet-resource:main" version="1.0">
      <map from="resource_url" to="url" />
      <map from="scheme_type" to="scheme_type" />
      <map from="url_host" to="url_host" />
      <map from="url_port" to="url_port" />
      <map from="url_path" to="url_path" />
      <map from="url_path_params" to="url_path_params" />
      <map from="is_directory" to="is_directory" />
      <map from="hier_type" to="hierarchy_type" />
      <map from="level0" to="path_level0" />
      <map from="level1" to="path_level1" />
      <map from="level2" to="path_level2" />
      <map from="level3" to="path_level3" />
      <map from="level4" to="path_level4" />
      <map from="level5" to="path_level5" />
      <map from="level6" to="path_level6" />
      <map from="level7" to="path_level7" />
      <map from="level8" to="path_level8" />
      <map from="level9" to="path_level9" />
      <map from="level10" to="path_level10" />
      <map from="level11" to="path_level11" />
      <map from="level12" to="path_level12" />
      <map from="level13" to="path_level13" />
      <map from="level14" to="path_level14" />
      <map from="level15" to="path_level15" />
    </block-ref>


  </blocks>

</process>
